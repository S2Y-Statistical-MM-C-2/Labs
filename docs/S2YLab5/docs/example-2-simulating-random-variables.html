<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Example 2: Simulating random variables | Lab 5 - Exploring relationships and understanding correlation</title>
  <meta name="description" content="4 Example 2: Simulating random variables | Lab 5 - Exploring relationships and understanding correlation" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Example 2: Simulating random variables | Lab 5 - Exploring relationships and understanding correlation" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Example 2: Simulating random variables | Lab 5 - Exploring relationships and understanding correlation" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exercise-1-multiple-linear-regression.html"/>
<link rel="next" href="example-3-spurious-correlation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to Lab 5</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#correlation-coefficient"><i class="fa fa-check"></i><b>1.1</b> Correlation coefficient</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-1-simple-linear-regression.html"><a href="example-1-simple-linear-regression.html"><i class="fa fa-check"></i><b>2</b> Example 1: Simple linear regression</a>
<ul>
<li class="chapter" data-level="2.1" data-path="example-1-simple-linear-regression.html"><a href="example-1-simple-linear-regression.html#creating-scatterplots"><i class="fa fa-check"></i><b>2.1</b> Creating scatterplots</a></li>
<li class="chapter" data-level="2.2" data-path="example-1-simple-linear-regression.html"><a href="example-1-simple-linear-regression.html#sample-correlation-coefficient"><i class="fa fa-check"></i><b>2.2</b> Sample correlation coefficient</a></li>
<li class="chapter" data-level="2.3" data-path="example-1-simple-linear-regression.html"><a href="example-1-simple-linear-regression.html#fitting-a-linear-model"><i class="fa fa-check"></i><b>2.3</b> Fitting a linear model</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise-1-multiple-linear-regression.html"><a href="exercise-1-multiple-linear-regression.html"><i class="fa fa-check"></i><b>3</b> Exercise 1: Multiple linear regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exercise-1-multiple-linear-regression.html"><a href="exercise-1-multiple-linear-regression.html#exploratory-analysis"><i class="fa fa-check"></i><b>3.1</b> Exploratory analysis</a></li>
<li class="chapter" data-level="3.2" data-path="exercise-1-multiple-linear-regression.html"><a href="exercise-1-multiple-linear-regression.html#fitting-a-linear-model-1"><i class="fa fa-check"></i><b>3.2</b> Fitting a linear model</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="example-2-simulating-random-variables.html"><a href="example-2-simulating-random-variables.html"><i class="fa fa-check"></i><b>4</b> Example 2: Simulating random variables</a>
<ul>
<li class="chapter" data-level="4.1" data-path="example-2-simulating-random-variables.html"><a href="example-2-simulating-random-variables.html#independent-random-variables"><i class="fa fa-check"></i><b>4.1</b> Independent random variables</a></li>
<li class="chapter" data-level="4.2" data-path="example-2-simulating-random-variables.html"><a href="example-2-simulating-random-variables.html#correlated-random-variables"><i class="fa fa-check"></i><b>4.2</b> Correlated random variables</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="example-3-spurious-correlation.html"><a href="example-3-spurious-correlation.html"><i class="fa fa-check"></i><b>5</b> Example 3: Spurious correlation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="example-3-spurious-correlation.html"><a href="example-3-spurious-correlation.html#investigating-the-relationship-with-scatterplot"><i class="fa fa-check"></i><b>5.1</b> Investigating the relationship with scatterplot</a></li>
<li class="chapter" data-level="5.2" data-path="example-3-spurious-correlation.html"><a href="example-3-spurious-correlation.html#further-analsyis-with-sample-correlation-coefficient"><i class="fa fa-check"></i><b>5.2</b> Further analsyis with sample correlation coefficient</a></li>
<li class="chapter" data-level="5.3" data-path="example-3-spurious-correlation.html"><a href="example-3-spurious-correlation.html#spurious-correlation"><i class="fa fa-check"></i><b>5.3</b> Spurious Correlation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercise-2-identifying-relationships.html"><a href="exercise-2-identifying-relationships.html"><i class="fa fa-check"></i><b>6</b> Exercise 2: Identifying relationships</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lab 5 - Exploring relationships and understanding correlation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-2-simulating-random-variables" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Example 2: Simulating random variables<a href="example-2-simulating-random-variables.html#example-2-simulating-random-variables" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We can use <code>R</code> to generate random variables. Here we will generate two random variables, <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, that are, or aren't, related to each other in some form. This can help us understand the relationship between two variables and how they may be correlated.</p>
<div id="independent-random-variables" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Independent random variables<a href="example-2-simulating-random-variables.html#independent-random-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let's start by first generating two random variables that are independent of one another. You have already been introduced to the <strong>normal distribution</strong>, where some random variable, <span class="math inline">\(X\)</span>, is centred at mean <span class="math inline">\(\mu\)</span>, with variance <span class="math inline">\(\sigma^2\)</span>, such that <span class="math inline">\(X \sim N(\mu, \sigma^2)\)</span>.</p>
<p>To generate random variables from the normal distribution we can use the <code>rnorm</code> command. For example, let's say we want to generate <span class="math inline">\(n=30\)</span> samples from two random variables, <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, each with mean <span class="math inline">\(\mu = 10\)</span>, and standard deviation <span class="math inline">\(\sigma = 1\)</span>, we can do this as follows:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="example-2-simulating-random-variables.html#cb18-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb18-2"><a href="example-2-simulating-random-variables.html#cb18-2" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb18-3"><a href="example-2-simulating-random-variables.html#cb18-3" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-4"><a href="example-2-simulating-random-variables.html#cb18-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb18-5"><a href="example-2-simulating-random-variables.html#cb18-5" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)</span>
<span id="cb18-6"><a href="example-2-simulating-random-variables.html#cb18-6" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)</span></code></pre></div>
<p>Note: since we are generating random numbers it is best to use the command <code>set.seed</code> beforehand to be able to replicate the results. For example, if we first run the line <code>set.seed(1)</code>, and then the above code, we will generate the same random variables <code>x</code> and <code>y</code>, and a different set if we change the seed value.</p>
<p>This gives us our random variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, generated independently of one another, and so we should expect to see no relationship between them. Using <code>set.seed(1)</code> to obtain <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, a scatterplot of their relationship is shown in Figure <a href="example-2-simulating-random-variables.html#fig:sim1">4.1</a>.</p>
<div class="figure"><span style="display:block;" id="fig:sim1"></span>
<img src="main_files/figure-html/sim1-1.png" alt="Scatterplots of independent random variables." width="672" />
<p class="caption">
Figure 4.1: Scatterplots of independent random variables.
</p>
</div>
<p><strong>QUESTION</strong>: What can we say about the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> from Figure <a href="example-2-simulating-random-variables.html#fig:sim1">4.1</a>? What can be said about the two boxplots in Figure <a href="example-2-simulating-random-variables.html#fig:sim1">4.1</a>?</p>
<p><strong>QUESTION</strong>: Use <code>R</code> as a calculator or the <code>cor()</code> function to calculate the correlation between the two variables. What does this value tell us about the their relationship?</p>
<p>The sample correlation <span class="math inline">\(r\)</span> = <input class='webex-solveme nospaces' size='10' data-answer='["0.04866964","0.0486696","0.04867","0.0487","0.049"]'/>, suggesting a <select class='webex-select'><option value='blank'></option><option value=''>strong</option><option value=''>moderate</option><option value=''>weak</option><option value='answer'>no</option></select> <select class='webex-select'><option value='blank'></option><option value=''></option><option value='answer'>linear</option></select> relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="example-2-simulating-random-variables.html#cb19-1" tabindex="-1"></a>x_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb19-2"><a href="example-2-simulating-random-variables.html#cb19-2" tabindex="-1"></a>y_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb19-3"><a href="example-2-simulating-random-variables.html#cb19-3" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">sum</span>((x<span class="sc">-</span>x_mean) <span class="sc">*</span> (y<span class="sc">-</span>y_mean)) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((x<span class="sc">-</span>x_mean)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sum</span>((y<span class="sc">-</span>y_mean)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb19-4"><a href="example-2-simulating-random-variables.html#cb19-4" tabindex="-1"></a><span class="fu">print</span>(r)</span></code></pre></div>
<pre><code>## [1] 0.04866964</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="example-2-simulating-random-variables.html#cb21-1" tabindex="-1"></a><span class="fu">cor</span>(x,y)</span></code></pre></div>
<pre><code>## [1] 0.04866964</code></pre>
</div>
</div>
<div id="correlated-random-variables" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Correlated random variables<a href="example-2-simulating-random-variables.html#correlated-random-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let us now look at how to generate random variables that are correlated in some way. To do that we will need to obtain the covariance or correlation matrix, and generate the random variables from a <strong>multivariate normal distribution</strong>. The multivariate normal distribution is a generalisation of the normal distribution to higher dimensions, and as multivariate data analysis is not covered until Honours level we will simplify things a little.</p>
<p>To generate correlated random variables we can use the <code>mvrnorm</code> command (load <code>library(MASS)</code>). This requires us to obtain the covariance matrix, <span class="math inline">\(\Sigma\)</span>, explaining the relationship between our two random variables. As you will find out in 2X, the covariance is scale dependent, and as such, the correlation is often easier to use and interpret.</p>
<p>We simplify things by generating random variables, <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, such that their variances are the same and equal to one. Assuming <span class="math inline">\(\text{Var}(X) = \text{Var}(Y) = 1\)</span>, we can then see from formula <a href="index.html#eq:corr">(1.1)</a> that</p>
<p><span class="math display">\[\rho(X,Y) =\frac{\mathrm{Cov}(X,Y)}{\sqrt{\mathrm{Var}(X)\mathrm{Var}(Y)}} = \frac{\mathrm{Cov}(X,Y)}{\sqrt{1 \cdot 1}} = \mathrm{Cov}(X,Y),\]</span></p>
<p>that is, the correlation and covariance are the same. This now means that the covariance matrix, <span class="math inline">\(\Sigma\)</span>, and the correlation matrix, <span class="math inline">\(P\)</span>, are now equivalent, such that,</p>
<p><span class="math display">\[\Sigma = \begin{bmatrix} \text{Var}(X) &amp; \text{Cov}(X, Y) \\ \text{Cov}(X, Y) &amp; \text{Var}(Y) \end{bmatrix}  = \begin{bmatrix} 1 &amp; \rho(X, Y) \\ \rho(X, Y) &amp; 1 \end{bmatrix} = P.\]</span></p>
<p>Now, let's say we want to generate two random variables, <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, from a multivariate normal distribution, such that <span class="math inline">\((X, Y) \sim N(\boldsymbol{\mu}, \Sigma)\)</span>. This can be done using the <code>mvrnorm</code> command as follows:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="example-2-simulating-random-variables.html#cb23-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb23-2"><a href="example-2-simulating-random-variables.html#cb23-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb23-3"><a href="example-2-simulating-random-variables.html#cb23-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb23-4"><a href="example-2-simulating-random-variables.html#cb23-4" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb23-5"><a href="example-2-simulating-random-variables.html#cb23-5" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.85</span></span>
<span id="cb23-6"><a href="example-2-simulating-random-variables.html#cb23-6" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(rho, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">2</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho)</span>
<span id="cb23-7"><a href="example-2-simulating-random-variables.html#cb23-7" tabindex="-1"></a>rand.vars <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n, <span class="at">mu =</span> mu, <span class="at">Sigma =</span> Sigma)</span>
<span id="cb23-8"><a href="example-2-simulating-random-variables.html#cb23-8" tabindex="-1"></a>x <span class="ot">&lt;-</span> rand.vars[, <span class="dv">1</span>]</span>
<span id="cb23-9"><a href="example-2-simulating-random-variables.html#cb23-9" tabindex="-1"></a>y <span class="ot">&lt;-</span> rand.vars[, <span class="dv">2</span>]</span></code></pre></div>
<p>Here we have generated <span class="math inline">\(n = 30\)</span> random samples from a multivariate normal distribution for <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, with mean vector <span class="math inline">\(\boldsymbol{\mu}^\top =\begin{bmatrix} \mu_X &amp; \mu_Y \end{bmatrix} = \begin{bmatrix}10 &amp; 10 \end{bmatrix}\)</span>, and correlation matrix, <span class="math inline">\(P\)</span>, such that <span class="math inline">\(\rho(X, Y) = 0.85\)</span>.</p>
<div class="figure"><span style="display:block;" id="fig:sim2"></span>
<img src="main_files/figure-html/sim2-1.png" alt="Scatterplots of correlated random variables." width="672" />
<p class="caption">
Figure 4.2: Scatterplots of correlated random variables.
</p>
</div>
<p><strong>QUESTION</strong>:</p>
<ol style="list-style-type: lower-alpha">
<li><p>What can we say about the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> from the scatterplot in Figure <a href="example-2-simulating-random-variables.html#fig:sim2">4.2</a>?</p></li>
<li><p>Calculate the sample correlation coefficient, <span class="math inline">\(r\)</span>. Is this the same as the correlation parameter, <span class="math inline">\(\rho\)</span>, used to generate the data?</p></li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<p>The sample correlation coefficient will not be exactly the same as the correlation parameter since the simulated data are random samples from the true population.</p>
</div>
<ol start="3" style="list-style-type: lower-alpha">
<li><p>What happens with the sample correlation, <span class="math inline">\(r\)</span>, and the 'true' correlation, <span class="math inline">\(\rho\)</span>, as the number of samples, <span class="math inline">\(n\)</span>, increases?</p></li>
<li><p>Edit the <code>R</code> code to obtain a weak-to-moderate positive linear relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. Use a scatterplot to examine this relationship, and use the <code>cor</code> command to see if the sample correlation matches that used to simulate the data.</p></li>
<li><p>Generate two random variables that exhibit a moderate-to-strong negative linear relationship. Use a plot to display this relationship, and obtain an estimate of the sample correlation coefficient.</p></li>
</ol>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Check Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Check Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="exercise-1-multiple-linear-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="example-3-spurious-correlation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["main.pdf", "main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
